.\" checkpoint.1 - manpage for checkpoint utility
.\" Generated for checkpoint v1.6.0
.\"
.TH CHECKPOINT 1 "December 2025" "checkpoint 1.6.0" "User Commands"
.SH NAME
checkpoint \- create and restore timestamped directory snapshots
.SH SYNOPSIS
.B checkpoint
[\fIOPTIONS\fR] [\fIDIRECTORY\fR]
.br
.B checkpoint
\fB\-\-list\fR [\fB\-d\fR \fIDIR\fR]
.br
.B checkpoint
\fB\-\-restore\fR [\fB\-\-from\fR \fIID\fR] [\fB\-\-to\fR \fIDIR\fR]
.br
.B checkpoint
\fB\-\-remote\fR \fIuser@host:path\fR [\fIOPTIONS\fR]
.SH DESCRIPTION
.B checkpoint
creates timestamped snapshots of directories with support for atomic operations,
concurrency protection, remote SSH backups, metadata tagging, selective restoration,
and checkpoint comparison.
.PP
Backups are stored in a \fI.gudang\fR directory by default, with each checkpoint
named using a timestamp format (YYYYMMDD_HHMMSS). Optional suffixes can be added
for descriptive naming.
.PP
Key features include:
.IP \(bu 3
Atomic backup operations (no partial backups on failure)
.IP \(bu 3
Hardlinking for space-efficient incremental backups
.IP \(bu 3
Lockfile-based concurrency protection
.IP \(bu 3
Remote operations via SSH with rsync
.IP \(bu 3
Rich metadata and tagging system
.IP \(bu 3
Selective file restoration and comparison
.IP \(bu 3
Cross-platform support (Linux and macOS)
.SH OPTIONS
.SS "Core Backup Options"
.TP
\fB\-d\fR, \fB\-\-backup\-dir\fR \fIDIR\fR
Use \fIDIR\fR as the backup directory instead of the default location.
.TP
\fB\-s\fR, \fB\-\-suffix\fR \fISUFFIX\fR
Append \fISUFFIX\fR to the checkpoint name. Must contain only alphanumeric
characters, dots, underscores, and hyphens.
.TP
\fB\-n\fR, \fB\-\-no\-hardlink\fR
Disable hardlinking to previous backups. Each file will be copied independently.
.TP
\fB\-\-hardlink\fR
Enable hardlinking to previous backups for space efficiency. This is the default
when the \fBhardlink\fR(1) utility is available.
.TP
\fB\-q\fR, \fB\-\-quiet\fR
Minimal output. Only print the backup path on success.
.TP
\fB\-v\fR, \fB\-\-verbose\fR
Verbose output (default).
.TP
\fB\-l\fR, \fB\-\-list\fR
List existing checkpoints instead of creating a new one.
.TP
\fB\-x\fR, \fB\-\-exclude\fR \fIPATTERN\fR
Add an exclusion pattern. Can be specified multiple times. Patterns are passed
to rsync's \fB\-\-exclude\fR option.
.SS "General Options"
.TP
\fB\-\-debug\fR
Enable debug output showing internal operations.
.TP
\fB\-\-verify\fR
Verify backup integrity after creation by comparing checksums.
.TP
\fB\-\-no\-sudo\fR
Do not attempt to use sudo for privilege escalation, even when running as root.
.TP
\fB\-V\fR, \fB\-\-version\fR
Print version information and exit.
.TP
\fB\-h\fR, \fB\-\-help\fR
Display help message and exit.
.SS "Backup Management Options"
.TP
\fB\-\-keep\fR \fINUM\fR
Keep only the \fINUM\fR most recent checkpoints, deleting older ones.
.TP
\fB\-\-age\fR \fIDAYS\fR
Remove checkpoints older than \fIDAYS\fR days.
.TP
\fB\-p\fR, \fB\-\-prune\-only\fR
Only prune old backups without creating a new checkpoint. Use with \fB\-\-keep\fR
or \fB\-\-age\fR.
.SS "Locking and Concurrency Options"
.TP
\fB\-\-no\-lock\fR
Disable the lockfile mechanism, allowing concurrent operations. Use with caution
as this may cause data corruption.
.TP
\fB\-\-lock\-timeout\fR \fISECONDS\fR
Maximum time to wait for lock acquisition. Default is 300 seconds (5 minutes).
.TP
\fB\-\-force\-unlock\fR
Force removal of stale locks before proceeding. Use when a previous operation
was interrupted and left a lock behind.
.SS "Restore Options"
.TP
\fB\-r\fR, \fB\-\-restore\fR
Restore files from a checkpoint.
.TP
\fB\-f\fR, \fB\-\-from\fR \fIID\fR
Source checkpoint to restore from. Defaults to the most recent checkpoint.
The \fIID\fR is the checkpoint directory name (e.g., 20250430_091429).
.TP
\fB\-t\fR, \fB\-\-to\fR \fIDIR\fR
Target directory for restoration. Defaults to the original source directory.
.TP
\fB\-\-dry\-run\fR
Preview changes without actually restoring files.
.TP
\fB\-\-diff\fR
Show differences between current files and the checkpoint.
.TP
\fB\-\-compare\-with\fR \fIID\fR
Compare two checkpoints with each other. Use with \fB\-\-from\fR to specify
the first checkpoint.
.TP
\fB\-\-detailed\fR
Show detailed output when comparing checkpoints.
.TP
\fB\-\-files\fR \fIPATTERN\fR
Select specific files or patterns to restore or compare. Can be specified
multiple times.
.SS "Metadata Options"
.TP
\fB\-\-metadata\fR
Perform metadata operations (used with \fB\-\-show\fR, \fB\-\-update\fR, or \fB\-\-find\fR).
.TP
\fB\-\-show\fR \fIID\fR
Display metadata for the specified checkpoint.
.TP
\fB\-\-update\fR \fIID\fR
Update metadata for the specified checkpoint.
.TP
\fB\-\-find\fR \fIPATTERN\fR
Search for checkpoints matching a metadata pattern. Pattern format is \fIKEY=VALUE\fR.
.TP
\fB\-\-desc\fR \fITEXT\fR
Set a description for the checkpoint.
.TP
\fB\-\-system\fR \fINAME\fR
Set the source system name in metadata.
.TP
\fB\-\-tag\fR \fIKEY=VALUE\fR
Add a searchable metadata tag. Can be specified multiple times.
.TP
\fB\-\-set\fR \fIKEY=VALUE\fR
Set or update a metadata key-value pair. Used with \fB\-\-update\fR.
.SS "Remote Operations Options"
.TP
\fB\-\-remote\fR \fISPEC\fR
Remote destination in format \fIuser@host:/path\fR. Enables SSH-based remote
backup and restore operations.
.TP
\fB\-\-timeout\fR \fISECONDS\fR
SSH connection timeout. Default is 30 seconds.
.SH EXIT STATUS
.TP
.B 0
Success.
.TP
.B 1
General error (directory not found, permission denied, operation failed).
.TP
.B 22
Invalid argument (bad option value, invalid number format).
.SH ENVIRONMENT
.TP
.B CHECKPOINT_BACKUP_DIR
Override the default backup directory location. When set, all backups will be
stored under this directory.
.TP
.B CHECKPOINT_AUTO_CONFIRM
When set to any value, automatically confirm directory creation prompts.
Useful for non-interactive environments and CI/CD pipelines.
.SH FILES
.TP
.I ~/.checkpoint/
Default backup directory for non-root users.
.TP
.I /var/backups/
Default backup directory for root users.
.TP
.I BACKUP_DIR/YYYYMMDD_HHMMSS/
Individual checkpoint directories named with timestamps.
.TP
.I CHECKPOINT/.metadata
Metadata file containing description, tags, and other attributes.
.TP
.I BACKUP_DIR/.checkpoint.lock/
Lock directory for concurrency protection. Contains \fIpid\fR, \fItimestamp\fR,
and \fIhostname\fR files.
.TP
.I BACKUP_DIR/.tmp.*/
Temporary directories used during atomic backup operations.
.SH EXAMPLES
.SS "Basic Operations"
Create a checkpoint of the current directory:
.PP
.RS
.nf
$ checkpoint
.fi
.RE
.PP
Create a checkpoint with a descriptive suffix:
.PP
.RS
.nf
$ checkpoint -s "before-refactor" ~/project
.fi
.RE
.PP
List existing checkpoints:
.PP
.RS
.nf
$ checkpoint --list
$ checkpoint -l -d ~/backups/project
.fi
.RE
.SS "Restoration"
Restore from the most recent checkpoint:
.PP
.RS
.nf
$ checkpoint --restore
.fi
.RE
.PP
Restore a specific checkpoint to a different location:
.PP
.RS
.nf
$ checkpoint --restore --from 20250430_091429 --to ~/restored
.fi
.RE
.PP
Preview restoration without making changes:
.PP
.RS
.nf
$ checkpoint --restore --dry-run
.fi
.RE
.PP
Restore only specific files:
.PP
.RS
.nf
$ checkpoint --restore --files "*.js" --files "docs/*.md"
.fi
.RE
.SS "Comparison"
Show differences between current files and latest checkpoint:
.PP
.RS
.nf
$ checkpoint --restore --diff
.fi
.RE
.PP
Compare two checkpoints:
.PP
.RS
.nf
$ checkpoint --from 20250430_091429 --compare-with 20250430_101530 --detailed
.fi
.RE
.SS "Metadata and Tagging"
Create a checkpoint with metadata:
.PP
.RS
.nf
$ checkpoint --desc "Release v2.1.0" --tag "version=2.1.0" --tag "status=testing"
.fi
.RE
.PP
Search checkpoints by tag:
.PP
.RS
.nf
$ checkpoint --metadata --find "version=2.1.0"
.fi
.RE
.PP
Update checkpoint metadata:
.PP
.RS
.nf
$ checkpoint --metadata --update 20250430_091429 --set "status=approved"
.fi
.RE
.SS "Remote Operations"
Backup to a remote server:
.PP
.RS
.nf
$ checkpoint --remote user@server:/backups ~/project
.fi
.RE
.PP
List remote checkpoints:
.PP
.RS
.nf
$ checkpoint --remote user@server:/backups --list
.fi
.RE
.PP
Restore from remote:
.PP
.RS
.nf
$ checkpoint --remote user@server:/backups --restore --from 20250430_091429
.fi
.RE
.SS "Backup Management"
Keep only the 5 most recent checkpoints:
.PP
.RS
.nf
$ checkpoint --keep 5
.fi
.RE
.PP
Remove checkpoints older than 30 days:
.PP
.RS
.nf
$ checkpoint --age 30
.fi
.RE
.PP
Prune without creating a new backup:
.PP
.RS
.nf
$ checkpoint --prune-only --keep 3 -d ~/backups/project
.fi
.RE
.SS "CI/CD Integration"
.PP
.RS
.nf
$ CHECKPOINT_AUTO_CONFIRM=1 checkpoint -s "build-${BUILD_NUMBER}"
.fi
.RE
.SH NOTES
.SS "Atomic Operations"
Backups are created in temporary directories (prefixed with \fI.tmp.\fR) and
only renamed to their final names after all operations complete successfully.
This ensures no partial or corrupted backups exist.
.SS "Hardlinking"
When the \fBhardlink\fR(1) utility is available, identical files between
checkpoints share the same disk blocks, potentially achieving 90%+ space savings
for incremental backups.
.SS "SSH Security"
Remote operations use hardened SSH options including BatchMode, StrictHostKeyChecking,
and IdentitiesOnly for secure non-interactive operation.
.SS "Default Exclusions"
The following patterns are automatically excluded from all backups:
.IP \(bu 3
\fI.gudang/\fR \- backup data directory
.IP \(bu 3
\fItemp/\fR, \fI.temp/\fR, \fItmp/\fR \- temporary directories
.IP \(bu 3
\fI*~\fR, \fI~*\fR \- backup files
.IP \(bu 3
\fI.tmp.*\fR \- atomic operation temporary directories
.IP \(bu 3
\fI.checkpoint.lock/\fR \- lock directories
.SH SEE ALSO
.BR rsync (1),
.BR ssh (1),
.BR hardlink (1),
.BR bats (1)
.SH BUGS
Report bugs at: https://github.com/okusi-id/checkpoint/issues
.SH AUTHOR
Written by Okusi Associates.
.\" fin
